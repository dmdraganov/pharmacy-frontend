import{d as e,g as t,h as n,i as r,m as i,o as a,p as o,s,u as c,y as l}from"./index-DjElomVe.js";import{t as u}from"./orders-DjM0b61R.js";var d=l(),f=o();const p=(0,d.memo)(({item:e})=>{let[t,i]=(0,d.useState)(null);return(0,d.useEffect)(()=>{r(e.product.image).then(i)},[e.product.image]),(0,f.jsxs)(`div`,{className:`flex items-center gap-4 py-2`,children:[(0,f.jsx)(`img`,{src:t??void 0,alt:e.product.name,className:`h-16 w-16 rounded object-cover`}),(0,f.jsx)(`div`,{className:`flex-grow`,children:(0,f.jsx)(n,{to:`/product/${e.product.id}`,className:`font-semibold text-text-default hover:text-primary hover:underline`,children:e.product.name})}),(0,f.jsxs)(`div`,{className:`text-right text-text-default`,children:[(0,f.jsxs)(`p`,{children:[e.quantity,` шт.`]}),(0,f.jsxs)(`p`,{className:`font-semibold`,children:[e.price*e.quantity,` ₽`]})]})]})});var m={new:{text:`Новый`,variant:`secondary`},processing:{text:`Собирается`,variant:`primary`},shipping:{text:`Передан в доставку`,variant:`warning`},delivered:{text:`Доставлен`,variant:`success`},completed:{text:`Завершён`,variant:`secondary`},cancelled:{text:`Отменён`,variant:`danger`}};const h=(0,d.memo)(({order:e,repeatAction:t})=>{let{id:n,date:r,status:i,total:o,items:s}=e,l=m[i],[u,h]=(0,d.useState)(!1);return(0,f.jsxs)(`div`,{className:`rounded-lg border border-border-default bg-background-default p-4`,children:[(0,f.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-4`,children:[(0,f.jsxs)(`div`,{className:`flex flex-col`,children:[(0,f.jsxs)(`span`,{className:`text-lg font-bold`,children:[`Заказ №`,n]}),(0,f.jsxs)(`span`,{className:`text-sm text-text-muted`,children:[`от `,new Date(r).toLocaleDateString(`ru-RU`)]})]}),(0,f.jsxs)(`div`,{className:`flex flex-col items-start sm:items-end`,children:[(0,f.jsx)(a,{variant:l.variant,children:l.text}),(0,f.jsxs)(`span`,{className:`mt-1 text-lg font-semibold`,children:[o,` ₽`]})]}),(0,f.jsxs)(`div`,{className:`flex w-full flex-wrap gap-2 sm:w-auto sm:flex-nowrap`,children:[t,(0,f.jsx)(c,{variant:`secondary`,className:`w-full sm:w-auto`,onClick:()=>h(!u),children:u?`Скрыть состав`:`Состав заказа`})]})]}),u&&(0,f.jsx)(`div`,{className:`mt-4 border-t border-border-default pt-4`,children:(0,f.jsx)(`div`,{className:`flex flex-col divide-y divide-border-default`,children:s.map(e=>(0,f.jsx)(p,{item:e},e.product.id))})})]})});var g={new:{text:`Новый`,variant:`secondary`},processing:{text:`Собирается`,variant:`primary`},shipping:{text:`Передан в доставку`,variant:`warning`},delivered:{text:`Доставлен`,variant:`success`},completed:{text:`Завершён`,variant:`secondary`},cancelled:{text:`Отменён`,variant:`danger`}};const _=(0,d.memo)(()=>{let e=(0,d.useMemo)(()=>u.find(e=>e.status===`processing`||e.status===`shipping`),[]);if(!e)return null;let{id:t,date:n,status:r,items:i,total:o}=e,s=g[r];return(0,f.jsxs)(`div`,{className:`rounded-lg border-2 border-primary bg-background-default p-6`,children:[(0,f.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-4`,children:[(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`h2`,{className:`text-2xl font-bold`,children:`Текущий заказ`}),(0,f.jsxs)(`p`,{className:`text-text-muted`,children:[`№`,t,` от `,new Date(n).toLocaleDateString(`ru-RU`)]})]}),(0,f.jsx)(a,{variant:s.variant,className:`px-4 py-2 text-base`,children:s.text})]}),(0,f.jsx)(`div`,{className:`my-4 border-t border-border-default`}),(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`p`,{className:`mb-2 font-semibold`,children:`Состав заказа:`}),(0,f.jsx)(`div`,{className:`flex flex-col divide-y divide-border-default`,children:i.map(e=>(0,f.jsx)(p,{item:e},e.product.id))})]}),(0,f.jsx)(`div`,{className:`mt-4 border-t border-border-default pt-4 text-right`,children:(0,f.jsxs)(`p`,{className:`text-xl font-bold`,children:[`Итого: `,o,` ₽`]})})]})}),v=(0,d.memo)(({order:e,className:t,onRepeatOrder:n})=>(0,f.jsx)(c,{variant:`primary`,className:t,onClick:()=>{n(e)},children:`Повторить заказ`})),y=(0,d.memo)(()=>{let{addItemsToCart:e}=i(),n=t(),r=t=>{e(t.items),n(`/cart`)},a=(0,d.useMemo)(()=>u.filter(e=>e.status===`completed`||e.status===`delivered`||e.status===`cancelled`),[]);return a.length===0?(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`h2`,{className:`mb-4 text-2xl font-bold text-text-heading`,children:`История заказов`}),(0,f.jsx)(`p`,{className:`text-text-default`,children:`Здесь будет список ваших прошлых заказов.`})]}):(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`h2`,{className:`mb-4 text-2xl font-bold text-text-heading`,children:`История заказов`}),(0,f.jsx)(`div`,{className:`flex flex-col gap-4`,children:a.slice(0,3).map(e=>(0,f.jsx)(h,{order:e,repeatAction:(e.status===`completed`||e.status===`cancelled`)&&(0,f.jsx)(v,{order:e,className:`w-full sm:w-auto`,onRepeatOrder:r})},e.id))}),a.length>3&&(0,f.jsx)(c,{variant:`secondary`,className:`mt-4`,disabled:!0,children:`Показать все`})]})}),b=(0,d.memo)(()=>{let{user:t,updateUser:n}=e(),[r,i]=(0,d.useState)(t),[a,o]=(0,d.useState)({}),[l,u]=(0,d.useState)(!1);(0,d.useEffect)(()=>{i(t)},[t]);let p=e=>{let{name:t,value:n}=e.target;i(e=>({...e,[t]:n})),a[t]&&o(e=>({...e,[t]:void 0}))},m=()=>{let e={};return r.firstName||(e.firstName=`Имя обязательно для заполнения`),r.lastName||(e.lastName=`Фамилия обязательна для заполнения`),r.email?/^\S+@\S+\.\S+$/.test(r.email)||(e.email=`Некорректный формат email`):e.email=`Email обязателен для заполнения`,r.phone?/^[-\d\s() +]+$/.test(r.phone)||(e.phone=`Номер телефона может содержать только цифры и символы +, -, (, )`):e.phone=`Телефон обязателен для заполнения`,o(e),Object.keys(e).length===0};return(0,f.jsxs)(`form`,{onSubmit:e=>{e.preventDefault(),m()&&(n(r),u(!0),setTimeout(()=>u(!1),2e3))},className:`rounded-lg border border-border-default bg-background-default p-6`,children:[(0,f.jsx)(`h2`,{className:`mb-4 text-2xl font-bold text-text-heading`,children:`Личные данные`}),(0,f.jsxs)(`div`,{className:`flex flex-col gap-4`,children:[(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`label`,{htmlFor:`firstName`,className:`mb-1 block text-sm font-medium text-text-default`,children:`Имя`}),(0,f.jsx)(s,{id:`firstName`,name:`firstName`,value:r.firstName,onChange:p,className:a.firstName?`border-danger`:``}),a.firstName&&(0,f.jsx)(`p`,{className:`mt-1 text-xs text-danger`,children:a.firstName})]}),(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`label`,{htmlFor:`lastName`,className:`mb-1 block text-sm font-medium text-text-default`,children:`Фамилия`}),(0,f.jsx)(s,{id:`lastName`,name:`lastName`,value:r.lastName,onChange:p,className:a.lastName?`border-danger`:``}),a.lastName&&(0,f.jsx)(`p`,{className:`mt-1 text-xs text-danger`,children:a.lastName})]}),(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`label`,{htmlFor:`phone`,className:`mb-1 block text-sm font-medium text-text-default`,children:`Телефон`}),(0,f.jsx)(s,{id:`phone`,name:`phone`,type:`tel`,value:r.phone,onChange:p,className:a.phone?`border-danger`:``}),a.phone&&(0,f.jsx)(`p`,{className:`mt-1 text-xs text-danger`,children:a.phone})]}),(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`label`,{htmlFor:`email`,className:`mb-1 block text-sm font-medium text-text-default`,children:`E-mail`}),(0,f.jsx)(s,{id:`email`,name:`email`,type:`email`,value:r.email,onChange:p,className:a.email?`border-danger`:``}),a.email&&(0,f.jsx)(`p`,{className:`mt-1 text-xs text-danger`,children:a.email})]})]}),(0,f.jsxs)(`div`,{className:`mt-6 flex items-center gap-4`,children:[(0,f.jsx)(c,{type:`submit`,variant:`primary`,children:`Сохранить изменения`}),l&&(0,f.jsx)(`span`,{className:`text-success`,children:`Данные успешно сохранены!`})]})]})});var x=({onClick:e,isActive:t,children:n})=>(0,f.jsx)(`button`,{onClick:e,className:`w-full rounded-md px-4 py-2 text-left font-medium transition-colors cursor-pointer ${t?`bg-primary text-text-inverse`:`bg-transparent text-text-default hover:bg-background-hover`}`,children:n}),S=({to:e,children:t})=>(0,f.jsx)(n,{to:e,className:`w-full rounded-md px-4 py-2 text-left font-medium text-text-default transition-colors hover:bg-background-hover cursor-pointer`,children:t});const C=(0,d.memo)(({activeView:t,setActiveView:n})=>{let{user:r}=e();return(0,f.jsxs)(`aside`,{className:`flex shrink-0 flex-col gap-8 rounded-lg border border-border-default bg-background-default p-4`,children:[(0,f.jsxs)(`div`,{className:`border-b border-border-default pb-4`,children:[(0,f.jsxs)(`p`,{className:`text-lg font-bold`,children:[r.firstName,` `,r.lastName]}),(0,f.jsx)(`p`,{className:`text-sm text-text-muted overflow-hidden text-ellipsis whitespace-nowrap`,children:r.email})]}),(0,f.jsxs)(`nav`,{className:`flex flex-grow flex-col gap-2`,children:[(0,f.jsx)(x,{onClick:()=>n(`orders`),isActive:t===`orders`,children:`Заказы`}),(0,f.jsx)(S,{to:`/cart`,children:`Корзина`}),(0,f.jsx)(S,{to:`/favorites`,children:`Избранное`})]}),(0,f.jsx)(`div`,{className:`mt-auto`,children:(0,f.jsx)(x,{onClick:()=>n(`profile`),isActive:t===`profile`,children:`Профиль`})})]})});var w=(0,d.memo)(()=>{let[e,t]=(0,d.useState)(`orders`);return(0,f.jsxs)(`div`,{className:`grid grid-cols-1 gap-8 md:grid-cols-4`,children:[(0,f.jsx)(`div`,{className:`md:col-span-1`,children:(0,f.jsx)(C,{activeView:e,setActiveView:t})}),(0,f.jsxs)(`main`,{className:`flex flex-col gap-8 md:col-span-3`,children:[e===`orders`&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(_,{}),(0,f.jsx)(y,{})]}),e===`profile`&&(0,f.jsx)(b,{})]})]})});export{w as default};