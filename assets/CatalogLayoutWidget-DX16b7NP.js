import{h as e,m as t,n,p as r,r as i,s as a,u as o,v as s,y as c}from"./index-DjElomVe.js";var l=c(),u=r(),d=({title:e,children:t,className:n})=>{let[r,i]=(0,l.useState)(!0);return(0,u.jsxs)(`div`,{className:[`border-b border-border-default`,n].filter(Boolean).join(` `),children:[(0,u.jsxs)(`button`,{onClick:()=>i(!r),className:`flex w-full items-center justify-between py-4 text-left font-semibold text-text-default cursor-pointer`,children:[(0,u.jsx)(`span`,{children:e}),(0,u.jsx)(`svg`,{className:`transform transition-transform ${r?`rotate-180`:``}`,width:`16`,height:`16`,viewBox:`0 0 16 16`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`,children:(0,u.jsx)(`path`,{d:`M4 6L8 10L12 6`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`})})]}),r&&(0,u.jsx)(`div`,{className:`pb-4`,children:t})]})};function f(e,t){let n=(0,l.useRef)(e),r=(0,l.useRef)(null);return(0,l.useEffect)(()=>{n.current=e},[e]),(0,l.useCallback)((...e)=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{n.current(...e)},t)},[t])}var p=({min:e,max:t,step:n=1,minValue:r,maxValue:i,onMinChange:o,onMaxChange:s,className:c})=>{let[d,p]=(0,l.useState)(r),[m,h]=(0,l.useState)(i),[g,_]=(0,l.useState)(String(r)),[v,y]=(0,l.useState)(String(i)),b=(0,l.useRef)(null),x=(0,l.useRef)(null),S=(0,l.useRef)(null),C=f(o,300),w=f(s,300);(0,l.useEffect)(()=>{p(r),_(String(r))},[r]),(0,l.useEffect)(()=>{h(i),y(String(i))},[i]);let T=(0,l.useCallback)(n=>t===e?0:(n-e)/(t-e)*100,[e,t]),E=(0,l.useCallback)(r=>{if(!b.current)return 0;let{left:i,width:a}=b.current.getBoundingClientRect(),o=e+Math.max(0,Math.min(1,(r-i)/a))*(t-e);return Math.round(o/n)*n},[e,t,n]),D=(e,t,n)=>{(0,l.useEffect)(()=>{let r=e.current;if(!r)return;let i=e=>{e.preventDefault(),e.stopPropagation();let r=e=>{t(n(E(e.clientX)))},i=()=>{document.removeEventListener(`mousemove`,r),document.removeEventListener(`mouseup`,i)};document.addEventListener(`mousemove`,r),document.addEventListener(`mouseup`,i)};return r.addEventListener(`mousedown`,i),()=>r.removeEventListener(`mousedown`,i)},[e,t,n])},O=e=>{p(e),_(String(e)),C(e)},k=e=>{h(e),y(String(e)),w(e)};D(x,O,e=>Math.min(e,m-n)),D(S,k,e=>Math.max(e,d+n));let A=e=>{let t=E(e.clientX),n=Math.abs(t-d),r=Math.abs(t-m);t<d?O(t):t>m?k(t):n<r?O(t):k(t)},j=()=>{let t=Number(g);(isNaN(t)||t<e)&&(t=e),t>m&&(t=m),p(t),_(String(t)),C(t)},M=()=>{let e=Number(v);(isNaN(e)||e>t)&&(e=t),e<d&&(e=d),h(e),y(String(e)),w(e)},N=e=>e.key===`Enter`&&j(),P=e=>e.key===`Enter`&&M(),F=T(d),I=T(m);return(0,u.jsxs)(`div`,{className:c,children:[(0,u.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,u.jsx)(a,{type:`number`,value:g,min:e,max:t,onChange:e=>_(e.target.value),onKeyDown:N,onBlur:j,placeholder:`От`,className:`w-full`}),(0,u.jsx)(`span`,{className:`text-text-muted`,children:`-`}),(0,u.jsx)(a,{type:`number`,value:v,min:e,max:t,onChange:e=>y(e.target.value),onKeyDown:P,onBlur:M,placeholder:`До`,className:`w-full`})]}),(0,u.jsx)(`div`,{className:`relative mt-6 flex h-8 items-center px-2`,children:(0,u.jsxs)(`div`,{ref:b,onMouseDown:A,className:`relative h-1 w-full cursor-pointer rounded-md bg-background-muted`,children:[(0,u.jsx)(`div`,{className:`absolute z-10 h-1 rounded-md bg-primary`,style:{left:`${F}%`,width:`${I-F}%`}}),(0,u.jsx)(`div`,{ref:x,className:`absolute top-1/2 z-20 -translate-x-1/2 -translate-y-1/2 h-4 w-4 cursor-grab rounded-full bg-primary-emphasis active:cursor-grabbing`,style:{left:`${F}%`}}),(0,u.jsx)(`div`,{ref:S,className:`absolute top-1/2 z-20 -translate-x-1/2 -translate-y-1/2 h-4 w-4 cursor-grab rounded-full bg-primary-emphasis active:cursor-grabbing`,style:{left:`${I}%`}})]})})]})};const m=()=>{let[e,t]=s();return{activeFilters:(0,l.useMemo)(()=>{let t=e.get(`minPrice`),n=e.get(`maxPrice`),r=e.getAll(`brand`),i=e.getAll(`category`),a=e.get(`isPrescription`);return{minPrice:t?Number(t):void 0,maxPrice:n?Number(n):void 0,brands:r.length>0?r:void 0,categories:i.length>0?i:void 0,isPrescription:a?a===`true`:void 0}},[e]),setFilter:(n,r)=>{let i=new URLSearchParams(e);i.delete(n),Array.isArray(r)?r.forEach(e=>i.append(n,e)):r&&i.set(n,r),t(i)},toggleFilter:(n,r)=>{let i=new URLSearchParams(e),a=i.getAll(n);if(a.includes(r)){let e=a.filter(e=>e!==r);i.delete(n),e.forEach(e=>i.append(n,e))}else i.append(n,r);t(i)},removeFilter:n=>{let r=new URLSearchParams(e);r.delete(n),t(r)}}};var h=({availableFilters:t,section:r,categories:i,className:a})=>{let{activeFilters:o,setFilter:s,toggleFilter:c,removeFilter:f}=m(),h=(0,l.useCallback)(e=>{s(`minPrice`,String(e))},[s]),g=(0,l.useCallback)(e=>{s(`maxPrice`,String(e))},[s]),_=o.minPrice??t.minPrice,v=Math.max(o.maxPrice??t.maxPrice,_);return(0,u.jsxs)(`aside`,{className:a,children:[(0,u.jsx)(`h2`,{className:`mb-4 text-xl font-bold text-text-heading`,children:`Фильтры`}),r&&i&&i.length>0&&(0,u.jsx)(d,{title:`Категории`,children:(0,u.jsx)(`div`,{className:`flex flex-col gap-2`,children:i.map(t=>(0,u.jsx)(e,{to:`/catalog/${r.id}/${t.id}`,className:`text-sm text-primary-emphasis hover:underline`,children:t.name},t.id))})}),(0,u.jsx)(d,{title:`Цена, ₽`,children:(0,u.jsx)(p,{min:t.minPrice,max:t.maxPrice,minValue:_,maxValue:v,onMinChange:h,onMaxChange:g})}),t.brands.length>0&&(0,u.jsx)(d,{title:`Бренд`,children:(0,u.jsx)(`div`,{className:`flex flex-col gap-2`,children:t.brands.map(e=>(0,u.jsx)(n,{id:`brand-${e}`,label:e,checked:o.brands?.includes(e)??!1,onChange:()=>c(`brand`,e)},e))})}),t.isPrescription&&(0,u.jsx)(d,{title:`Рецепт`,children:(0,u.jsx)(n,{id:`prescription`,label:`По рецепту`,checked:o.isPrescription??!1,onChange:e=>{let{checked:t}=e.target;t?s(`isPrescription`,`true`):f(`isPrescription`)}})})]})};const g=e=>{if(e.length===0)return{minPrice:0,maxPrice:0,brands:[],isPrescription:!1};let t=e.map(e=>e.price),n=new Set(e.map(e=>e.brand)),r=e.some(e=>e.isPrescription);return{minPrice:Math.min(...t),maxPrice:Math.max(...t),brands:Array.from(n).sort(),isPrescription:r}},_=(e,t)=>{let n=e;return t.minPrice!==void 0&&(n=n.filter(e=>e.price>=t.minPrice)),t.maxPrice!==void 0&&(n=n.filter(e=>e.price<=t.maxPrice)),t.brands&&t.brands.length>0&&(n=n.filter(e=>t.brands.includes(e.brand))),t.categories&&t.categories.length>0&&(n=n.filter(e=>t.categories.includes(e.categoryId))),t.isPrescription!==void 0&&(n=n.filter(e=>!!e.isPrescription===t.isPrescription)),n},v=({data:e,itemsPerPage:t})=>{let[n,r]=(0,l.useState)(1),i=Math.ceil(e.length/t);return{currentPage:n,totalPages:i,currentData:(0,l.useMemo)(()=>{let r=(n-1)*t,i=r+t;return e.slice(r,i)},[e,n,t]),goToPage:e=>{r(e)},next:()=>{r(e=>Math.min(e+1,i))},prev:()=>{r(e=>Math.max(e-1,1))}}};var y=({currentPage:e,totalPages:t,goToPage:n})=>t<=1?null:(0,u.jsx)(`div`,{className:`mt-8 flex justify-center gap-2`,children:Array.from({length:t},(e,t)=>t+1).map(t=>(0,u.jsx)(o,{variant:`primary`,onClick:()=>n(t),disabled:e===t,children:t},t))}),b=8,x=({title:e,products:n})=>{let{addToCart:r,updateQuantity:a,removeFromCart:o,getQuantityInCart:s}=t(),{currentData:c,currentPage:l,totalPages:d,goToPage:f}=v({data:n,itemsPerPage:b});return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(`h1`,{className:`mb-4 text-2xl font-bold text-text-heading`,children:e}),(0,u.jsx)(`div`,{className:`grid grid-cols-1 gap-6 lg:grid-cols-2 xl:grid-cols-3`,children:c.length>0?c.map(e=>(0,u.jsx)(i,{product:e,quantityInCart:s(e.id),onAddToCart:r,onUpdateQuantity:a,onRemoveFromCart:o},e.id)):(0,u.jsx)(`p`,{className:`text-text-default`,children:`Пока нет товаров.`})}),d>1&&(0,u.jsx)(`div`,{className:`mt-4`,children:(0,u.jsx)(y,{currentPage:l,totalPages:d,goToPage:f})})]})},S=({title:e,products:t,sidebar:n})=>(0,u.jsxs)(`div`,{className:`flex flex-grow gap-6`,children:[n&&(0,u.jsx)(`aside`,{className:`hidden md:block w-72 shrink-0 overflow-y-auto py-12`,children:n}),(0,u.jsx)(`main`,{className:`flex-grow overflow-y-auto py-12`,children:(0,u.jsx)(x,{title:e,products:t})})]});export{m as a,h as i,_ as n,g as r,S as t};